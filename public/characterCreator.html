<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Creator - Realms</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/characterCreator.css">
</head>
<body>
    <header id="header"></header>
    <main>
        <div class="tabs">
            <button class="tab-button" data-tab="step1">Step 1: Decide on an Archetype</button>
            <button class="tab-button" data-tab="step2">Step 2: Determine your Ancestry</button>
            <button class="tab-button" data-tab="step3">Step 3: Determine Abilities</button>
            <button class="tab-button" data-tab="step4">Step 4: Build your Archetype</button>
            <button class="tab-button" data-tab="step5">Step 5: Fill in Details</button>
            <button class="tab-button" data-tab="step6">Step 6: Equip Your Character</button>
        </div>
        <div id="step1" class="tab-content">
            <p>Your character’s role, theme, and general playstyle, which will help guide their Abilities, Feats, and Development.</p>
            <p>Do you wish to wield power's, harness martial prowess, or perhaps a bit of both?</p>
            <div class="archetype-buttons">
                <button class="archetype-button" onclick="selectArchetype(this, 'martial')">Create Martial Character</button>
                <button class="archetype-button" onclick="selectArchetype(this, 'powered-martial')">Create Powered-Martial Character</button>
                <button class="archetype-button" onclick="selectArchetype(this, 'power')">Create Power Character</button>
            </div>
            <div id="martial-options" class="martial-options" style="display: none;">
                <p>Perfect! Now you must pick your Martial Ability. This reflects your character’s physical Combat style and approach to challenges.</p>
                <div class="ability-buttons">
                    <button class="ability-button martial" data-tooltip="Strength governs physical Actions like lifting, breaking, throwing, climbing, and stability. It determines your chance to hit and damage dealt with melee weapons.">Strength</button>
                    <button class="ability-button martial" data-tooltip="Vitality represents resilience and endurance, affecting resistance to damage, toxins, illnesses, and more. It also contributes to your Health (HP) each level.">Vitality</button>
                    <button class="ability-button martial" data-tooltip="Agility measures speed and reflexes, affecting Evasion (EV), and Speed (SP). It determines your chance to hit and damage dealt with melee or ranged finesse weapons.">Agility</button>
                    <button class="ability-button martial" data-tooltip="Acuity reflects mental sharpness, influencing perception, reaction, and aim. It determines your chance to hit and damage dealt with ranged weapons.">Acuity</button>
                    <button class="ability-button martial" data-tooltip="Intelligence covers knowledge, problem-solving, memory, and your understanding of history, lore, and language.">Intelligence</button>
                    <button class="ability-button martial" data-tooltip="Charisma governs social Skills, including persuasion, intimidation, and emotional intelligence. It also represents your presence, poise, resolve and confidence.">Charisma</button>
                </div>
            </div>
            <div id="powered-martial-options" class="powered-martial-options" style="display: none;">
                <p class="centered-text">Thrilling! Now you must pick your Martial Ability as well as your Power Ability. These reflect your character’s physical Combat style and approach to challenges as well as your connection to supernatural, magical, or extraordinary abilities.</p>
                <div class="ability-sections">
                    <div class="ability-section">
                        <h4>Martial Ability</h4>
                        <div class="ability-buttons">
                            <button class="ability-button martial" data-tooltip="Strength governs physical Actions like lifting, breaking, throwing, climbing, and stability. It determines your chance to hit and damage dealt with melee weapons.">Strength</button>
                            <button class="ability-button martial" data-tooltip="Vitality represents resilience and endurance, affecting resistance to damage, toxins, illnesses, and more. It also contributes to your Health (HP) each level.">Vitality</button>
                            <button class="ability-button martial" data-tooltip="Agility measures speed and reflexes, affecting Evasion (EV), and Speed (SP). It determines your chance to hit and damage dealt with melee or ranged finesse weapons.">Agility</button>
                            <button class="ability-button martial" data-tooltip="Acuity reflects mental sharpness, influencing perception, reaction, and aim. It determines your chance to hit and damage dealt with ranged weapons.">Acuity</button>
                            <button class="ability-button martial" data-tooltip="Intelligence covers knowledge, problem-solving, memory, and your understanding of history, lore, and language.">Intelligence</button>
                            <button class="ability-button martial" data-tooltip="Charisma governs social Skills, including persuasion, intimidation, and emotional intelligence. It also represents your presence, poise, resolve and confidence.">Charisma</button>
                        </div>
                    </div>
                    <div class="ability-section">
                        <h4>Power Ability</h4>
                        <div class="ability-buttons">
                            <button class="ability-button power" data-tooltip="Strength governs physical Actions like lifting, breaking, throwing, climbing, and stability. It determines your chance to hit and damage dealt with melee weapons.">Strength</button>
                            <button class="ability-button power" data-tooltip="Vitality represents resilience and endurance, affecting resistance to damage, toxins, illnesses, and more. It also contributes to your Health (HP) each level.">Vitality</button>
                            <button class="ability-button power" data-tooltip="Agility measures speed and reflexes, affecting Evasion (EV), and Speed (SP). It determines your chance to hit and damage dealt with melee or ranged finesse weapons.">Agility</button>
                            <button class="ability-button power" data-tooltip="Acuity reflects mental sharpness, influencing perception, reaction, and aim. It determines your chance to hit and damage dealt with ranged weapons.">Acuity</button>
                            <button class="ability-button power" data-tooltip="Intelligence covers knowledge, problem-solving, memory, and your understanding of history, lore, and language.">Intelligence</button>
                            <button class="ability-button power" data-tooltip="Charisma governs social Skills, including persuasion, intimidation, and emotional intelligence. It also represents your presence, poise, resolve and confidence.">Charisma</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="power-options" class="power-options" style="display: none;">
                <p>Wonderful! Now you must pick your Power Ability. This represents your character’s connection to supernatural, magical, or extraordinary abilities.</p>
                <div class="ability-buttons">
                    <button class="ability-button power" data-tooltip="Strength governs physical Actions like lifting, breaking, throwing, climbing, and stability. It determines your chance to hit and damage dealt with melee weapons.">Strength</button>
                    <button class="ability-button power" data-tooltip="Vitality represents resilience and endurance, affecting resistance to damage, toxins, illnesses, and more. It also contributes to your Health (HP) each level.">Vitality</button>
                    <button class="ability-button power" data-tooltip="Agility measures speed and reflexes, affecting Evasion (EV), and Speed (SP). It determines your chance to hit and damage dealt with melee or ranged finesse weapons.">Agility</button>
                    <button class="ability-button power" data-tooltip="Acuity reflects mental sharpness, influencing perception, reaction, and aim. It determines your chance to hit and damage dealt with ranged weapons.">Acuity</button>
                    <button class="ability-button power" data-tooltip="Intelligence covers knowledge, problem-solving, memory, and your understanding of history, lore, and language.">Intelligence</button>
                    <button class="ability-button power" data-tooltip="Charisma governs social Skills, including persuasion, intimidation, and emotional intelligence. It also represents your presence, poise, resolve and confidence.">Charisma</button>
                </div>
            </div>
        </div>
        <div id="step2" class="tab-content">
            <p class="centered-text">Your character’s Species and Ancestry define their genetic predispositions and inherent qualities. The Species represents a broad classification, while Ancestry delves into the specific traits and attributes passed down through generations.</p>
            <p class="centered-text">Choose a species to learn more about it!</p>
            <select id="speciesDropdown" class="normal-dropdown">
                <option value="">Select a species</option>
                <!-- Species options will be populated here -->
            </select>
            <div id="speciesDetails" class="centered-text" style="display: none;">
                <button id="descriptionButton">Description</button>
                <div id="descriptionModal" style="display: none;">
                    <p id="speciesDescription"></p>
                    <button id="closeDescriptionButton">Close</button>
                </div>
                <div id="speciesInfoBox">
                    <div id="speciesInfo">
                        <div class="species-row">
                            <span class="species-title">Species:</span>
                            <span id="speciesName"></span>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Average Height:</span>
                            <span id="averageHeight"></span>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Average Weight:</span>
                            <span id="averageWeight"></span>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Species Type:</span>
                            <span id="speciesType"></span>
                        </div>
                        <hr class="species-divider">
                        <div class="species-row">
                            <span class="species-title">Size:</span>
                            <select id="sizeDropdown" class="normal-dropdown"></select>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Skills:</span>
                            <span id="skills"></span>
                            <select id="skillsDropdown" class="normal-dropdown" style="display: none;"></select>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Adulthood:</span>
                            <span id="adulthood"></span>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Max Age:</span>
                            <span id="maxAge"></span>
                            <div class="vertical-divider"></div>
                            <span class="species-title">Languages:</span>
                            <span id="languages"></span>
                            <select id="languagesDropdown" class="normal-dropdown" style="display: none;"></select>
                        </div>
                        <hr class="species-divider">
                        <div class="species-row">
                            <span class="species-title">Your Age:</span>
                            <input type="text" id="yourAge">
                            <div class="vertical-divider"></div>
                            <span class="species-title">Your Height:</span>
                            <input type="text" id="yourHeight">
                            <div class="vertical-divider"></div>
                            <span class="species-title">Your Weight:</span>
                            <input type="text" id="yourWeight">
                            <div class="vertical-divider"></div>
                            <span class="species-title">Your Gender:</span>
                            <input type="text" id="yourGender">
                        </div>
                    </div>
                </div>
                <div class="species-details-box">
                    <div class="expandable-box">
                        <div class="summary-row">
                            <span>Species Traits</span>
                            <span class="expand-arrow">▼</span>
                        </div>
                        <div class="details-row" style="display: none;">
                            <ul id="speciesTraitsList"></ul>
                        </div>
                    </div>
                    <div class="expandable-box">
                        <div class="summary-row">
                            <span>Choose Ancestry Trait</span>
                            <span class="expand-arrow">▼</span>
                        </div>
                        <div class="details-row" style="display: none;">
                            <select id="ancestryTraitDropdown" class="normal-dropdown"></select>
                            <p id="ancestryTraitDescription"></p>
                        </div>
                    </div>
                    <div class="expandable-box">
                        <div class="summary-row">
                            <span>Choose Characteristic</span>
                            <span class="expand-arrow">▼</span>
                        </div>
                        <div class="details-row" style="display: none;">
                            <select id="characteristicDropdown" class="normal-dropdown"></select>
                            <p id="characteristicDescription"></p>
                        </div>
                    </div>
                    <div class="expandable-box">
                        <div class="summary-row">
                            <span>Choose Flaw (Optional)</span>
                            <span class="expand-arrow">▼</span>
                        </div>
                        <div class="details-row" style="display: none;">
                            <select id="flawDropdown" class="normal-dropdown"></select>
                            <p id="flawDescription"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="step3" class="tab-content">
            <p>It’s time to define your core Abilities! These Abilities form the foundation of your character’s physical and mental capabilities and will influence their role in Combat, exploration, and other interactions.</p>
            <div class="ability-row">
                <div class="ability-box">
                    <div class="ability-name">Strength</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="ability-box">
                    <div class="ability-name">Vitality</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="ability-box">
                    <div class="ability-name">Agility</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="ability-box">
                    <div class="ability-name">Acuity</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="ability-box">
                    <div class="ability-name">Intelligence</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="ability-box">
                    <div class="ability-name">Charisma</div>
                    <select class="ability-dropdown">
                        <option value="">Select</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
            </div>
            <div class="ability-points-box">
                <div class="ability-points-title">Ability Points to Allocate</div>
                <div id="remaining-points" class="ability-points-value">7</div>
            </div>
        </div>
        <div id="step4" class="tab-content">
            <p>Based on your Archetype, choose Feats and determine your Skill, Armor, Weapon, Martial, and Power Proficiencies.</p>
            <div class="archetype-feats-box">
                <div class="archetype-feats-title">Archetype Feats</div>
                <div id="archetype-feats-list" class="archetype-feats-list"></div>
            </div>
        </div>
        <div id="step5" class="tab-content">
            <p>Using the choices you’ve made fill in the remaining details on your character sheet.</p>
        </div>
        <div id="step6" class="tab-content">
            <p>Finally, you will create and choose your character’s Powers, Techniques, and Armaments, then fill their inventory with Items.</p>
        </div>
    </main>
    <footer id="footer"></footer>
    <script type="module">
      import { initializeFirebase, handleAuthStateChange } from './scripts/auth.js';
      import { initializeTabs, showMartialOptions, showPoweredMartialOptions, showPowerOptions, initializeAbilityButtons, selectArchetype, populateSpeciesDropdown, displaySpeciesDetails, populateSkillDropdown, populateLanguageDropdown, populateSizeDropdown, toggleExpandableBox, updateTraitDescription, toggleDescriptionModal, initializeAbilityDropdowns, initializeArchetypeFeats, updateFeatDescription } from './scripts/characterCreator.js';

      async function loadHeaderFooter() {
        const header = document.getElementById('header');
        const footer = document.getElementById('footer');
        if (header) {
          header.innerHTML = await fetch('/header.html').then(response => response.text());
        }
        if (footer) {
          footer.innerHTML = await fetch('/footer.html').then(response => response.text());
        }
      }
      loadHeaderFooter();

      document.addEventListener('DOMContentLoaded', async function() {
        const { auth, db } = await initializeFirebase();
        handleAuthStateChange(auth, db);
        initializeTabs();
        initializeAbilityButtons();
        populateSpeciesDropdown();
        document.getElementById('speciesDropdown').addEventListener('change', displaySpeciesDetails);
        document.querySelectorAll('.expandable-box .summary-row').forEach(row => {
          row.addEventListener('click', toggleExpandableBox);
        });
        document.getElementById('ancestryTraitDropdown').addEventListener('change', updateTraitDescription);
        document.getElementById('characteristicDropdown').addEventListener('change', updateTraitDescription);
        document.getElementById('flawDropdown').addEventListener('change', updateTraitDescription);
        document.getElementById('descriptionButton').addEventListener('click', toggleDescriptionModal);
        initializeAbilityDropdowns();
        initializeArchetypeFeats();
      });

      // Attach the functions to the window object
      window.showMartialOptions = showMartialOptions;
      window.showPoweredMartialOptions = showPoweredMartialOptions;
      window.showPowerOptions = showPowerOptions;
      window.selectArchetype = selectArchetype;
      window.updateFeatDescription = updateFeatDescription;
    </script>
</body>
</html>
