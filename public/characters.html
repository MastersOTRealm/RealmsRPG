<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Characters - Realms: The Freeform Roleplaying Game</title>
    <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <header id="header"></header>
    <main>
        <section id="characters-section">
            <h2>Characters</h2>

            <div class="character-grid">
                <!-- ==== SLOT 1 – Sample Character ==== -->
                <a href="/character/characterSheet.html" class="character-card sample">
                    <div class="portrait">
                        <img src="/images/sample-paris.jpg" alt="Paris Capaxiah">
                    </div>
                    <p class="name">PARIS CAPAXIAH</p>
                </a>

                <!-- ==== SLOT 2 – Existing Character (example) ==== -->
                <div class="character-card">
                    <div class="portrait">
                        <img src="/images/sleek.jpg" alt="Sleek">
                    </div>
                    <p class="name">SLEEK</p>
                </div>

                <!-- ==== SLOT 3 – Add New ==== -->
                <div class="character-card add-new" id="add-character-slot">
                    <div class="portrait placeholder">
                        <span class="plus">+</span>
                    </div>
                    <p class="name add-text">Add Character</p>
                </div>
            </div>
        </section>
    </main>
    <footer id="footer"></footer>
    <script type="module">
      import { initializeFirebase, handleAuthStateChange } from './scripts/auth.js';

      async function loadHeaderFooter() {
        const header = document.getElementById('header');
        const footer = document.getElementById('footer');
        if (header) {
          header.innerHTML = await fetch('/header.html').then(response => response.text());
        }
        if (footer) {
          footer.innerHTML = await fetch('/footer.html').then(response => response.text());
        }
      }
      loadHeaderFooter();

      document.addEventListener('DOMContentLoaded', async () => {
        const { auth, db } = await initializeFirebase();
        handleAuthStateChange(auth, db);

        const grid = document.querySelector('.character-grid');
        const addSlot = document.getElementById('add-character-slot');

        // ---- Click on “Add” → go to creator ----
        addSlot.addEventListener('click', () => {
          window.location.href = '/characterCreator.html';
        });

        // ---- Load user characters from Firestore ----
        if (auth.currentUser) {
          const uid = auth.currentUser.uid;
          const snap = await db.collection('users').doc(uid).collection('characters')
                        .orderBy('createdAt', 'desc').get();

          // Remove placeholder cards except the “add” one
          grid.innerHTML = '';
          grid.appendChild(addSlot);   // keep the + at the end

          snap.forEach(doc => {
            const data = doc.data();
            const card = document.createElement('div');
            card.className = 'character-card';
            card.innerHTML = `
              <div class="portrait">
                <img src="${data.portrait || '/images/default-avatar.png'}" alt="${data.name}">
              </div>
              <p class="name">${(data.name || 'Unnamed').toUpperCase()}</p>
            `;
            // Click → open character sheet
            card.addEventListener('click', () => {
              window.location.href = `/character/${doc.id}/sheet.html`;
            });
            grid.insertBefore(card, addSlot);   // insert before the + slot
          });
        }
      });
    </script>
</body>
</html>
